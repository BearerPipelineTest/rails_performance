<%= render '/rails_performance/css' %>

<title>Number of Requests to the Application</title>

<% unless @datasource.default? %>
  <%= link_to raw("&larr; Back"), rails_performance_path, class: "back_link" %>
<% end %>

<br/>
<br/>
<br/>

<div class="card">
  <h1>Throughput Report<h1>
  <div id="throughput_report_chart"></div>
  <p class="hint">All requests (site visitors, search engines, bots, etc)</p>
</div>

<br/>
<br/>
<br/>

<div class="card">
  <h1>Average Response Time Report<h1>
  <div id="response_time_report_chart"></div>
  <p class="hint">All requests (site visitors, search engines, bots, etc)</p>
</div>

<br/>
<br/>
<br/>

<div class="card">
  <h1>Requests (path, total number, average response time)<h1>
  <table>
    <thead>
      <tr>
        <th colspan='3'>Name</th>
        <th colspan='3'>Average (ms)</th>
        <th colspan='3'>Slowest (ms)</th>
      </tr>
      <tr>
        <th>Controller#Action</th>
        <th>Format</th>
        <th>Requests</th>
        <th>Duration</th>
        <th>Views</th>
        <th>DB</th>
        <th>Duration</th>
        <th>Views</th>
        <th>DB</th>
      </tr>
    </thead>
    <tbody>
      <% @global_report_data.each do |e| %>
        <% groups = e[:group].split("|") %>
        <tr>
          <td><%= statistics_link groups[0], @global_report, e[:group] %></td>
          <td><%= groups[1]&.upcase %></td>
          <td><%= e[:count] %></td>
          <td><%= round_it e[:duration_average] %></td>
          <td><%= round_it e[:view_runtime_average] %></td>
          <td><%= round_it e[:db_runtime_average] %></td>
          <td><%= round_it e[:duration_slowest] %></td>
          <td><%= round_it e[:view_runtime_slowest] %></td>
          <td><%= round_it e[:db_runtime_slowest] %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<br/>
<br/>
<br/>


<%= render '/rails_performance/js' %>

<script>
  var data1 = <%= raw @throughput_report_data.to_json %>;
  showTIRChart('throughput_report_chart', data1);

  var data2 = <%= raw @response_time_report_data.to_json %>;
  showRTChart('response_time_report_chart', data2);
</script>

